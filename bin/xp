#!/usr/bin/env coffee
util = require 'util'
eyes = require 'eyes'
xp = require '../lib/xp'

# parse command line arguments with optimist
argv = (require 'optimist').argv

# load xp tools
tools = xp.loadTools()
help  = []
usage = ''

tools.forEach (tool, i) -> 
  usage += ' ' + tool + " |"

usage = usage.substr(0,usage.length-1)

# generate help based on argv._

help.push "usage: xp ["+usage+"] [ options ]"
help.push "options:"

# generate default help 
help.push "  -s, --silent   Silence stdout and stderr", "  -h, --help     Help", ""
help = help.join '\n'



# Show help prompt if requested or if the incorrect usage options are supplied
if (argv.h || argv.help || (argv._.length == 0) || typeof xp[argv._[0]] == 'undefined')
  console.log help
  return

# execute tool
xp[argv._[0]].exec argv, (err, result) -> 
  if err
    console.log('ERROR:'.red.bold + ' ' + err.message.grey)